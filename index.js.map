{"version":3,"file":"index.js","sources":["src/actions.js","src/selectors.js","src/utils.js","src/reducer.js","src/index.js"],"sourcesContent":["export const SET = prefix => `SET_${prefix}`\nexport const set = prefix => payload => ({ type: SET(prefix), payload })\n\nexport const RESET = prefix => `RESET_${prefix}`\nexport const reset = prefix => () => ({ type: RESET(prefix) })\n\nexport const ADD = prefix => `ADD_${prefix}`\nexport const add = prefix => payload => ({ type: ADD(prefix), payload })\n\nexport const DEL = prefix => `DEL_${prefix}`\nexport const del = prefix => key => ({ type: DEL(prefix), payload: key })\n","import { at } from 'lodash'\n\nexport const getState = path => prefix => (state) => {\n  let subState = state\n  if (path !== undefined) subState = at(state, path)[0]\n\n  return subState[prefix]\n}\n\nconst getFactory = key => path => prefix => state => getState(path)(prefix)(state)[key]\nexport const getKeys = getFactory('keys')\nexport const getAsArray = getFactory('array')\nexport const getNb = getFactory('nb')\nexport const isInitialized = getFactory('initialized')\n\nconst getDatas = getFactory('datas')\nexport const get = path => prefix => keys => (state) => {\n  const datas = getDatas(path)(prefix)(state)\n  // All datas\n  if (!keys) return datas\n  // By keys\n  if (Array.isArray(keys)) return keys.map(k => datas[k])\n  // By key\n  return datas[keys]\n}\n","export default payload => key => keys => (getNextId, start) => {\n  if (!getNextId || (keys.length === 0 && !start)) return payload\n  // use case SET action\n  if (Array.isArray(payload)) {\n    let sequence = [start]\n    return payload.map((p) => {\n      if (!p[key]) {\n        const raw = { ...p, [key]: getNextId(sequence) }\n        sequence = [...sequence, raw[key]]\n        return raw\n      }\n      return p\n    })\n  }\n  // use case ADD action\n  if (payload[key]) return payload\n  return { ...payload, [key]: getNextId(keys || [start]) }\n}\n","import { keyBy, without, uniq, omit } from 'lodash'\nimport { SET, ADD, DEL, RESET } from './actions'\nimport generateId from './utils'\n\nexport const initState = { datas: {}, keys: [], array: [], nb: 0, initialized: false }\n\nexport default (key, getNextId, start) => prefix =>\n  (state = initState, { type = 'UNKONWN', payload } = {}) => {\n    switch (type) {\n      case SET(prefix): {\n        const p = generateId(payload)(key)(state.keys)(getNextId, start)\n        return {\n          datas: keyBy(p, key),\n          keys: p.map(element => element[key]),\n          array: p,\n          nb: p.length,\n          initialized: true,\n        }\n      }\n      case ADD(prefix): {\n        const p = generateId(payload)(key)(state.keys)(getNextId, start)\n        return {\n          ...state,\n          datas: { ...state.datas, [p[key]]: p },\n          keys: uniq([...state.keys, p[key]]),\n          array: [...state.array, p],\n          nb: state.keys.length + 1,\n          initialized: true,\n        }\n      }\n      case DEL(prefix):\n        return {\n          ...state,\n          datas: omit(state.datas, [payload]),\n          keys: without(state.keys, payload),\n          array: state.array ? state.array.filter(o => o[key] !== payload) : [],\n          nb: state.keys.length - 1,\n        }\n      case RESET(prefix):\n        return initState\n      default:\n        return state\n    }\n  }\n","import * as actions from './actions'\nimport * as selectors from './selectors'\nimport reducer from './reducer'\n\nexport default (key, getNextKey, start) => path => prefix => Object.assign(\n  reducer(key, getNextKey, start)(prefix),\n  ...Object.keys(actions).map(k => ({ [k]: actions[k](prefix) })),\n  ...Object.keys(selectors).map(k => ({ [k]: selectors[k](path)(prefix) })),\n)\n"],"names":["SET","prefix","RESET","ADD","DEL","type","payload","key","getState","state","subState","undefined","path","_at","getFactory","getKeys","getAsArray","getNb","isInitialized","getDatas","datas","keys","Array","isArray","map","k","getNextId","start","length","sequence","p","raw","initState","array","nb","initialized","generateId","_keyBy","element","_uniq","_omit","_without","filter","o","getNextKey","Object","assign","reducer","actions","selectors"],"mappings":"klBAAO,IAAMA,EAAM,yBAAiBC,GAGvBC,EAAQ,2BAAmBD,GAG3BE,EAAM,yBAAiBF,GAGvBG,EAAM,yBAAiBH,8BARjB,mBAAU,mBAAcI,KAAML,EAAIC,GAASK,2BAGzC,mBAAU,kBAASD,KAAMH,EAAMD,gBAGjC,mBAAU,mBAAcI,KAAMF,EAAIF,GAASK,uBAG3C,mBAAU,mBAAUD,KAAMD,EAAIH,GAASK,QAASC,OCRtDC,EAAW,mBAAQ,mBAAU,SAACC,OACrCC,EAAWD,cACFE,IAATC,IAAoBF,EAAWG,EAAGJ,EAAOG,GAAM,IAE5CF,EAAST,MAGZa,EAAa,mBAAO,mBAAQ,mBAAU,mBAASN,EAASI,GAAMX,GAAQQ,GAAOF,OACtEQ,EAAUD,EAAW,QACrBE,EAAaF,EAAW,SACxBG,EAAQH,EAAW,MACnBI,EAAgBJ,EAAW,eAElCK,EAAWL,EAAW,wFACT,mBAAQ,mBAAU,mBAAQ,SAACL,OACtCW,EAAQD,EAASP,GAAMX,GAAQQ,UAEhCY,EAEDC,MAAMC,QAAQF,GAAcA,EAAKG,IAAI,mBAAKJ,EAAMK,KAE7CL,EAAMC,GAJKD,mbCnBM,mBAAO,mBAAQ,SAACM,EAAWC,OAC9CD,GAA8B,IAAhBL,EAAKO,SAAiBD,EAAQ,OAAOrB,KAEpDgB,MAAMC,QAAQjB,GAAU,KACtBuB,GAAYF,UACTrB,EAAQkB,IAAI,SAACM,OACbA,EAAEvB,GAAM,KACLwB,OAAWD,OAAIvB,EAAMmB,EAAUG,0BACtBA,IAAUE,EAAIxB,KACtBwB,SAEFD,WAIPxB,EAAQC,GAAaD,OACbA,OAAUC,EAAMmB,EAAUL,IAASM,UCZpCK,GAAcZ,SAAWC,QAAUY,SAAWC,GAAI,EAAGC,aAAa,cAE/D5B,EAAKmB,EAAWC,UAAU,mBACxC,eAAClB,yDAAQuB,kEAAa3B,KAAAA,aAAO,YAAWC,IAAAA,eAC9BD,QACDL,EAAIC,OACD6B,EAAIM,EAAW9B,GAASC,GAAKE,EAAMY,MAAMK,EAAWC,gBAEjDU,EAAMP,EAAGvB,QACVuB,EAAEN,IAAI,mBAAWc,EAAQ/B,WACxBuB,KACHA,EAAEF,oBACO,QAGZzB,EAAIF,OACD6B,EAAIM,EAAW9B,GAASC,GAAKE,EAAMY,MAAMK,EAAWC,eAErDlB,cACSA,EAAMW,WAAQU,EAAEvB,GAAOuB,SAC7BS,cAAS9B,EAAMY,OAAMS,EAAEvB,wBAClBE,EAAMwB,QAAOH,OACpBrB,EAAMY,KAAKO,OAAS,eACX,SAGZxB,EAAIH,eAEFQ,SACI+B,EAAK/B,EAAMW,OAAQd,SACpBmC,EAAQhC,EAAMY,KAAMf,SACnBG,EAAMwB,MAAQxB,EAAMwB,MAAMS,OAAO,mBAAKC,EAAEpC,KAASD,UACpDG,EAAMY,KAAKO,OAAS,SAEvB1B,EAAMD,UACF+B,iBAEAvB,sBCrCCF,EAAKqC,EAAYjB,UAAU,mBAAQ,mBAAUkB,OAAOC,qBAClEC,EAAQxC,EAAKqC,EAAYjB,GAAO1B,aAC7B4C,OAAOxB,KAAK2B,GAASxB,IAAI,wBAASC,EAAIuB,EAAQvB,GAAGxB,SACjD4C,OAAOxB,KAAK4B,GAAWzB,IAAI,wBAASC,EAAIwB,EAAUxB,GAAGb,GAAMX"}