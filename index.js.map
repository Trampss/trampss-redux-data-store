{"version":3,"file":"index.js","sources":["src/actions.js","src/selectors.js","src/middlewares/core.js","src/reducer.js","src/index.js"],"sourcesContent":["export const SET = prefix => `SET_${prefix}`\nexport const set = prefix => payload => ({ type: SET(prefix), payload })\n\nexport const RESET = prefix => `RESET_${prefix}`\nexport const reset = prefix => () => ({ type: RESET(prefix) })\n\nexport const ADD = prefix => `ADD_${prefix}`\nexport const add = prefix => payload => ({ type: ADD(prefix), payload })\n\nexport const DEL = prefix => `DEL_${prefix}`\nexport const del = prefix => key => ({ type: DEL(prefix), payload: key })\n","import { at } from 'lodash'\n\nexport const getState = path => prefix => (state) => {\n  let subState = state\n  if (path !== undefined) subState = at(state, path)[0]\n\n  return subState[prefix]\n}\n\nconst getFactory = key => path => prefix => state => getState(path)(prefix)(state)[key]\nexport const getKeys = getFactory('keys')\nexport const getAsArray = getFactory('array')\nexport const getNb = getFactory('nb')\nexport const isInitialized = getFactory('initialized')\n\nconst getData = getFactory('data')\nexport const get = path => prefix => keys => (state) => {\n  const data = getData(path)(prefix)(state)\n  // All data\n  if (!keys) return data\n  // By keys\n  if (Array.isArray(keys)) return keys.map(k => data[k])\n  // By key\n  return data[keys]\n}\n\nexport const getBy = path => prefix => (propertyPath, values) => (state) => {\n  const data = getAsArray(path)(prefix)(state)\n  if (!data) return []\n  if (Array.isArray(values)) return data.filter(d => values.includes(at(d, propertyPath)[0]))\n  return data.filter(d => values === at(d, propertyPath)[0])\n}\n","import { keyBy, without, uniq, omit } from 'lodash'\nimport { SET, ADD, DEL, RESET } from '../actions'\nimport { initState } from '../reducer'\n\nconst coreReducer = key => prefix =>\n  (state = initState, { type, payload } = {}) => {\n    switch (type) {\n      case SET(prefix):\n        return {\n          data: keyBy(payload, key),\n          keys: payload.map(element => element[key]),\n          array: payload,\n          nb: payload.length,\n          initialized: true,\n        }\n      case ADD(prefix):\n        return {\n          ...state,\n          data: { ...state.data, [payload[key]]: payload },\n          keys: uniq([...state.keys, payload[key]]),\n          array: [...state.array, payload],\n          nb: state.keys.length + 1,\n          initialized: true,\n        }\n      case DEL(prefix):\n        return {\n          ...state,\n          data: omit(state.data, [payload]),\n          keys: without(state.keys, payload),\n          array: state.array ? state.array.filter(o => o[key] !== payload) : [],\n          nb: state.keys.length - 1,\n        }\n      case RESET(prefix):\n        return initState\n      default:\n        return state\n    }\n  }\n\nexport default key => prefix => (ctx = {}) => ({\n  ...ctx,\n  state: coreReducer(key)(prefix)(ctx.state, ctx.action),\n})\n","import { core } from './middlewares'\n\nexport const initState = { data: {}, keys: [], array: [], nb: 0, initialized: false }\n\nexport default (middlewares = {}) => key => prefix =>\n  (state = initState, { type = 'UNKNOWN', payload } = {}) => {\n    let prevCtx = { state, action: { type, payload } }\n\n    // middlewares to call (in right order)\n    const middlewaresToCall = [\n      ...(middlewares.pre || []),\n      core,\n      ...(middlewares.post || []),\n    ]\n\n    middlewaresToCall\n      // pass parameters\n      .map(middleware => middleware(key)(prefix))\n      // call middlewares\n      .forEach((middleware) => {\n        prevCtx = middleware(prevCtx)\n      })\n\n    // returns last results to Redux\n    return prevCtx.state\n  }\n","import * as actions from './actions'\nimport * as selectors from './selectors'\nimport reducer from './reducer'\n\nexport default middlewares => key => path => prefix => Object.assign(\n  reducer(middlewares)(key)(prefix),\n  ...Object.keys(actions).map(k => ({ [k]: actions[k](prefix) })),\n  ...Object.keys(selectors).map(k => ({ [k]: selectors[k](path)(prefix) })),\n)\n"],"names":["SET","prefix","RESET","ADD","DEL","type","payload","key","getState","state","subState","undefined","path","_at","getFactory","getKeys","getAsArray","getNb","isInitialized","getData","data","keys","Array","isArray","map","k","propertyPath","values","filter","includes","d","coreReducer","initState","_keyBy","element","length","_uniq","array","_omit","_without","o","ctx","action","nb","initialized","middlewares","prevCtx","pre","core","post","middleware","forEach","Object","assign","reducer","actions","selectors"],"mappings":"klBAAO,IAAMA,EAAM,yBAAiBC,GAGvBC,EAAQ,2BAAmBD,GAG3BE,EAAM,yBAAiBF,GAGvBG,EAAM,yBAAiBH,8BARjB,mBAAU,mBAAcI,KAAML,EAAIC,GAASK,2BAGzC,mBAAU,kBAASD,KAAMH,EAAMD,gBAGjC,mBAAU,mBAAcI,KAAMF,EAAIF,GAASK,uBAG3C,mBAAU,mBAAUD,KAAMD,EAAIH,GAASK,QAASC,OCRtDC,EAAW,mBAAQ,mBAAU,SAACC,OACrCC,EAAWD,cACFE,IAATC,IAAoBF,EAAWG,EAAGJ,EAAOG,GAAM,IAE5CF,EAAST,MAGZa,EAAa,mBAAO,mBAAQ,mBAAU,mBAASN,EAASI,GAAMX,GAAQQ,GAAOF,OACtEQ,EAAUD,EAAW,QACrBE,EAAaF,EAAW,SACxBG,EAAQH,EAAW,MACnBI,EAAgBJ,EAAW,eAElCK,EAAUL,EAAW,uFACR,mBAAQ,mBAAU,mBAAQ,SAACL,OACtCW,EAAOD,EAAQP,GAAMX,GAAQQ,UAE9BY,EAEDC,MAAMC,QAAQF,GAAcA,EAAKG,IAAI,mBAAKJ,EAAKK,KAE5CL,EAAKC,GAJMD,YAOC,mBAAQ,mBAAU,SAACM,EAAcC,UAAW,SAAClB,OAC1DW,EAAOJ,EAAWJ,GAAMX,GAAQQ,UACjCW,EACDE,MAAMC,QAAQI,GAAgBP,EAAKQ,OAAO,mBAAKD,EAAOE,SAAShB,EAAGiB,EAAGJ,GAAc,MAChFN,EAAKQ,OAAO,mBAAKD,IAAWd,EAAGiB,EAAGJ,GAAc,oaC1BnDK,EAAc,mBAAO,mBACzB,eAACtB,yDAAQuB,8DAAa3B,IAAAA,KAAMC,IAAAA,eAClBD,QACDL,EAAIC,eAECgC,EAAM3B,EAASC,QACfD,EAAQkB,IAAI,mBAAWU,EAAQ3B,WAC9BD,KACHA,EAAQ6B,oBACC,QAEZhC,EAAIF,eAEFQ,aACQA,EAAMW,UAAOd,EAAQC,GAAOD,SACjC8B,cAAS3B,EAAMY,OAAMf,EAAQC,wBACxBE,EAAM4B,QAAO/B,OACpBG,EAAMY,KAAKc,OAAS,eACX,SAEZ/B,EAAIH,eAEFQ,QACG6B,EAAK7B,EAAMW,MAAOd,SAClBiC,EAAQ9B,EAAMY,KAAMf,SACnBG,EAAM4B,MAAQ5B,EAAM4B,MAAMT,OAAO,mBAAKY,EAAEjC,KAASD,UACpDG,EAAMY,KAAKc,OAAS,SAEvBjC,EAAMD,UACF+B,iBAEAvB,2BAIO,mBAAU,eAACgC,wEAC5BA,SACIV,EAAYxB,GAAKN,GAAQwC,EAAIhC,MAAOgC,EAAIC,aCvCpCV,GAAcZ,QAAUC,QAAUgB,SAAWM,GAAI,EAAGC,aAAa,oBAE9DC,mEAAqB,mBAAO,mBAC1C,eAACpC,yDAAQuB,kEAAa3B,KAChByC,GAAYrC,QAAOiC,QAAUrC,gBADN,YACYC,UADDA,4BAKhCuC,EAAYE,UAChBC,KACIH,EAAYI,WAKfzB,IAAI,mBAAc0B,EAAW3C,GAAKN,KAElCkD,QAAQ,SAACD,KACEA,EAAWJ,KAIlBA,EAAQrC,oCCpBW,mBAAO,mBAAQ,mBAAU2C,OAAOC,qBAC5DC,EAAQT,GAAatC,GAAKN,aACvBmD,OAAO/B,KAAKkC,GAAS/B,IAAI,wBAASC,EAAI8B,EAAQ9B,GAAGxB,SACjDmD,OAAO/B,KAAKmC,GAAWhC,IAAI,wBAASC,EAAI+B,EAAU/B,GAAGb,GAAMX"}