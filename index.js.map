{"version":3,"file":"index.js","sources":["src/actions.js","src/selectors.js","src/middlewares/core.js","src/reducer.js","src/index.js"],"sourcesContent":["const scope = action => `@trampss/${action.toUpperCase()}`\n\nexport const SET = prefix => scope(`SET_${prefix}`)\nexport const set = prefix => payload => ({ type: SET(prefix), payload })\n\nexport const RESET = prefix => scope(`RESET_${prefix}`)\nexport const reset = prefix => () => ({ type: RESET(prefix) })\n\nexport const ADD = prefix => scope(`ADD_${prefix}`)\nexport const add = prefix => payload => ({ type: ADD(prefix), payload })\n\nexport const UPDATE = prefix => scope(`UPDATE_${prefix}`)\nexport const update = prefix => payload => ({ type: UPDATE(prefix), payload })\n\nexport const REMOVE = prefix => scope(`REMOVE_${prefix}`)\nexport const remove = prefix => key => ({ type: REMOVE(prefix), payload: key })\n","import { at } from 'lodash'\n\nexport const getState = path => prefix => (state) => {\n  let subState = state\n  if (path !== undefined) subState = at(state, path)[0]\n\n  return subState[prefix]\n}\n\nconst getFactory = key => path => prefix => state => getState(path)(prefix)(state)[key]\nexport const getKeys = getFactory('keys')\nexport const getAsArray = getFactory('array')\nexport const getLength = path => prefix => state => getKeys(path)(prefix)(state).length\nexport const isInitialized = getFactory('initialized')\n\nconst getData = getFactory('data')\nexport const get = path => prefix => keys => (state) => {\n  const data = getData(path)(prefix)(state)\n  // All data\n  if (!keys) return data\n  // By keys\n  if (Array.isArray(keys)) return keys.map(k => data[k])\n  // By key\n  return data[keys]\n}\n\nexport const getBy = path => prefix => (propertyPath, values) => (state) => {\n  const data = getAsArray(path)(prefix)(state)\n  if (Array.isArray(values)) return data.filter(d => values.includes(at(d, propertyPath)[0]))\n  return data.filter(d => values === at(d, propertyPath)[0])\n}\n","import { keyBy, without, uniq, omit } from 'lodash'\nimport { SET, ADD, UPDATE, REMOVE, RESET } from '../actions'\nimport { initState } from '../reducer'\n\nconst coreReducer = key => prefix =>\n  (state = initState, { type, payload } = {}) => {\n    switch (type) {\n      case SET(prefix):\n        return {\n          data: keyBy(payload, key),\n          keys: uniq(payload.map(element => element[key])),\n          array: payload,\n          initialized: true,\n        }\n      case ADD(prefix): {\n        const sameKey = state.array.find(o => o[key] === payload[key])\n        let array\n        if (sameKey === undefined) {\n          array = [...state.array, payload]\n        } else {\n          array = state.array.map(\n            o => (o[key] === payload[key] ? payload : o),\n          )\n        }\n\n        return {\n          ...state,\n          data: { ...state.data, [payload[key]]: payload },\n          keys: uniq([...state.keys, payload[key]]),\n          array,\n          initialized: true,\n        }\n      }\n      case UPDATE(prefix): {\n        const instanceKey = payload[key]\n        if (!instanceKey) return state\n        return {\n          ...state,\n          data: { ...state.data, [instanceKey]: { ...state.data[instanceKey], ...payload } },\n          array: state.array.map(o => (o[key] === instanceKey ? { ...o, ...payload } : o)),\n        }\n      }\n      case REMOVE(prefix):\n        return {\n          ...state,\n          data: omit(state.data, [payload]),\n          keys: without(state.keys, payload),\n          array: state.array ? state.array.filter(o => o[key] !== payload) : [],\n        }\n      case RESET(prefix):\n        return initState\n      default:\n        return state\n    }\n  }\n\nexport default key => prefix => (ctx = {}) => ({\n  ...ctx,\n  state: coreReducer(key)(prefix)(ctx.state, ctx.action),\n})\n","import { core } from './middlewares'\n\nexport const initState = { data: {}, keys: [], array: [], initialized: false }\n\nexport default (middlewares = {}) => key => prefix =>\n  (state = initState, { type = 'UNKNOWN', payload } = {}) => {\n    let prevCtx = { state, action: { type, payload } }\n\n    // middlewares to call (in right order)\n    const middlewaresToCall = [\n      ...(middlewares.pre || []),\n      core,\n      ...(middlewares.post || []),\n    ]\n\n    middlewaresToCall\n      // pass parameters\n      .map(middleware => middleware(key)(prefix))\n      // call middlewares\n      .forEach((middleware) => {\n        prevCtx = middleware(prevCtx)\n      })\n\n    // returns last results to Redux\n    return prevCtx.state\n  }\n","import * as actions from './actions'\nimport * as selectors from './selectors'\nimport reducer from './reducer'\n\nconst func = middlewares => key => path => prefix => name => Object.assign(\n  reducer(middlewares)(key)(`${prefix}${name}`),\n  ...Object.keys(actions).map(k => ({ [k]: actions[k](`${prefix}${name}`) })),\n  ...Object.keys(selectors).map(k => ({ [k]: selectors[k](path)(name) })),\n)\n\n\nexport default middlewares => key => path => (options) => {\n  let name\n  let prefix = ''\n\n  // retrieve options\n  if (typeof options === 'string') name = options\n  else {\n    name = options.name\n    prefix = (options.prefix) || ''\n  }\n\n  return func(middlewares)(key)(path)(prefix)(name)\n}\n"],"names":["scope","action","toUpperCase","SET","prefix","RESET","ADD","UPDATE","REMOVE","type","payload","key","getState","state","subState","undefined","path","_at","getFactory","getKeys","getAsArray","isInitialized","getData","length","data","keys","Array","isArray","map","k","propertyPath","values","filter","includes","d","coreReducer","initState","_keyBy","_uniq","element","array","find","o","instanceKey","_omit","_without","ctx","initialized","middlewares","prevCtx","pre","core","post","middleware","forEach","func","Object","assign","reducer","name","actions","selectors","options"],"mappings":"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"}