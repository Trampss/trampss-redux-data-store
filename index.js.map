{"version":3,"file":"index.js","sources":["src/actions.js","src/selectors.js","src/middlewares/keyValue.js","src/types/keyValue.js","src/middlewares/simpleObject.js","src/types/simpleObject.js","src/reducer.js","src/index.js"],"sourcesContent":["const scope = action => `@trampss/${action.toUpperCase()}`\n\nexport const SET = prefix => scope(`SET_${prefix}`)\nexport const set = prefix => payload => ({ type: SET(prefix), payload })\n\nexport const RESET = prefix => scope(`RESET_${prefix}`)\nexport const reset = prefix => () => ({ type: RESET(prefix) })\n\nexport const ADD = prefix => scope(`ADD_${prefix}`)\nexport const add = prefix => payload => ({ type: ADD(prefix), payload })\n\nexport const UPDATE = prefix => scope(`UPDATE_${prefix}`)\nexport const update = prefix => payload => ({ type: UPDATE(prefix), payload })\n\nexport const REMOVE = prefix => scope(`REMOVE_${prefix}`)\nexport const remove = prefix => key => ({ type: REMOVE(prefix), payload: key })\n\nexport const ADD_OR_UPDATE = prefix => scope(`ADD_OR_UPDATE_${prefix}`)\nexport const addOrUpdate = prefix => payload => ({ type: ADD_OR_UPDATE(prefix), payload })\n","import { at } from 'lodash'\n\nexport const getState = path => prefix => (state) => {\n  let subState = state\n  if (path !== undefined) subState = at(state, path)[0]\n\n  return subState[prefix]\n}\n\nconst getFactory = key => path => prefix => state => getState(path)(prefix)(state)[key]\nexport const getKeys = getFactory('keys')\nexport const getAsArray = getFactory('array')\nexport const getLength = path => prefix => state => getKeys(path)(prefix)(state).length\nexport const isInitialized = getFactory('initialized')\n\nconst getData = getFactory('data')\nexport const get = path => prefix => keys => (state) => {\n  const data = getData(path)(prefix)(state)\n  // All data\n  if (!keys) return data\n  // By keys\n  if (Array.isArray(keys)) return keys.map(k => data[k])\n  // By key\n  return data[keys]\n}\n\nexport const getBy = path => prefix => (propertyPath, values) => (state) => {\n  const data = getAsArray(path)(prefix)(state)\n  if (Array.isArray(values)) return data.filter(d => values.includes(at(d, propertyPath)[0]))\n  return data.filter(d => values === at(d, propertyPath)[0])\n}\n","import { keyBy, without, uniq, omit } from 'lodash'\nimport { SET, ADD, UPDATE, REMOVE, RESET, ADD_OR_UPDATE } from '../actions'\n\nexport const initState = { data: {}, keys: [], array: [], initialized: false }\n\nconst keyAlreadyExists =\n  state => (key, instanceKey) => state.array.find(o => o[key] === instanceKey)\n\nconst add = (key, state, payload) => {\n  let array\n  const instanceKey = payload[key]\n  if (!keyAlreadyExists(state)(key, instanceKey)) {\n    array = [...state.array, payload]\n  } else {\n    array = state.array.map(o => (o[key] === instanceKey ? payload : o))\n  }\n\n  return {\n    ...state,\n    data: { ...state.data, [instanceKey]: payload },\n    keys: uniq([...state.keys, instanceKey]),\n    array,\n    initialized: true,\n  }\n}\n\nconst update = (key, state, payload) => {\n  const instanceKey = payload[key]\n\n  return {\n    ...state,\n    data: { ...state.data, [instanceKey]: { ...state.data[instanceKey], ...payload } },\n    array: state.array.map(o => (o[key] === instanceKey ? { ...o, ...payload } : o)),\n  }\n}\n\nconst reducer = key => prefix => (/* defaultData */) =>\n  (state = initState, { type, payload } = {}) => {\n    switch (type) {\n      case SET(prefix):\n        return {\n          data: keyBy(payload, key),\n          keys: uniq(payload.map(element => element[key])),\n          array: payload,\n          initialized: true,\n        }\n      case ADD(prefix): return add(key, state, payload)\n      case ADD_OR_UPDATE(prefix): {\n        if (!keyAlreadyExists(state)(key, payload[key])) return add(key, state, payload)\n        return update(key, state, payload)\n      }\n      case UPDATE(prefix): {\n        if (!keyAlreadyExists(state)(key, payload[key])) return state\n        return update(key, state, payload)\n      }\n      case REMOVE(prefix):\n        return {\n          ...state,\n          data: omit(state.data, [payload]),\n          keys: without(state.keys, payload),\n          array: state.array ? state.array.filter(o => o[key] !== payload) : [],\n        }\n      case RESET(prefix):\n        return initState\n      default:\n        return state\n    }\n  }\n\nexport default key => prefix => defaultData => (ctx = {}) => ({\n  ...ctx,\n  state: reducer(key)(prefix)(defaultData)(ctx.state, ctx.action),\n})\n","import keyValue from '../middlewares/keyValue'\n\nexport default {\n  middlewares: [keyValue],\n  actions: ['set', 'add', 'reset', 'remove', 'update', 'addorupdate'],\n  selectors: ['getState', 'getKeys', 'getAsArray', 'getLength', 'isInitialized', 'get', 'getBy'],\n}\n","import { SET, RESET, UPDATE } from '../actions'\n\nexport const initState = { data: undefined, initialized: false }\n\nconst init = defaultData => ({ ...initState, data: defaultData })\n\nconst reducer = (/* key */) => prefix => defaultData =>\n  (state = init(defaultData), { type, payload } = {}) => {\n    switch (type) {\n      case SET(prefix):\n        return {\n          data: payload,\n          initialized: true,\n        }\n      case UPDATE(prefix):\n        return {\n          ...state,\n          data: {\n            ...state.data,\n            ...payload,\n          },\n        }\n      case RESET(prefix):\n        return init(defaultData)\n      default:\n        return state\n    }\n  }\n\nexport default key => prefix => defaultData => (ctx = {}) => ({\n  ...ctx,\n  state: reducer(key)(prefix)(defaultData)(ctx.state, ctx.action),\n})\n","import simpleObject from '../middlewares/simpleObject'\n\nexport default {\n  middlewares: [simpleObject],\n  actions: ['set', 'reset', 'update'],\n  selectors: ['getState', 'isInitialized', 'get'],\n}\n","export default middlewares => key => prefix => defaultData =>\n  (state, { type = 'UNKNOWN', payload } = {}) => {\n    let prevCtx = { state, action: { type, payload } }\n\n    // middlewares to call (in right order)\n    const middlewaresToCall = [\n      // injected by user\n      ...(middlewares.pre || []),\n      // injected by types selection (reducer type)\n      ...(middlewares.engine || []),\n      // injected by user\n      ...(middlewares.post || []),\n    ]\n\n    middlewaresToCall\n      // pass parameters\n      .map(middleware => middleware(key)(prefix)(defaultData))\n      // call middlewares\n      .forEach((middleware) => {\n        prevCtx = middleware(prevCtx)\n      })\n\n    // returns last results to Redux\n    return prevCtx.state\n  }\n","import * as actions from './actions'\nimport * as selectors from './selectors'\nimport * as types from './types'\nimport reducer from './reducer'\n\nconst getWrappedStore = (middlewares = {}) => (options) => {\n  const { key, path, type = 'keyValue', prefix = '', name, defaultData } = options\n  const typeConfig = types[type]\n\n  return Object.assign(\n    reducer({ ...middlewares, engine: typeConfig.middlewares })(key)(`${prefix}${name}`)(defaultData),\n\n    // type (debug purpose)\n    { trampssType: type },\n\n    // actions\n    ...Object.keys(actions)\n      .filter(k => typeConfig.actions.includes(k.toLowerCase()))\n      .map(k => ({ [k]: actions[k](`${prefix}${name}`) })),\n\n    // selectors\n    ...Object.keys(selectors)\n      .filter(k => typeConfig.selectors.includes(k))\n      .map(k => ({ [k]: selectors[k](path)(name) })),\n  )\n}\n\n// error :( - not a middleware nor an option parameter\nconst error = () => { throw Error('parameter is not a middleware configuration, nor a factory option object.') }\n\n// params checkers\nconst isMiddleware = params => params.engine || params.pre || params.post\nconst isOptions = params => (!!params.name) || (typeof params === 'string')\n\n// eslint-disable-next-line consistent-return\nconst factory = (forcedOptions = {}) => (params) => {\n  // no param : error\n  if (params === null || params === undefined) error()\n\n  // middleware case\n  if (isMiddleware(params)) {\n    return options => getWrappedStore(params)({ ...options, ...forcedOptions })\n  }\n  // no middleware case\n  if (isOptions(params)) {\n    if (typeof params === 'string') return getWrappedStore()({ name: params, ...forcedOptions })\n    return getWrappedStore()({ ...params, ...forcedOptions })\n  }\n\n  // not a valid param\n  error()\n}\n\nexport const simpleObject = factory({ type: 'simpleObject' })\nexport const keyValue = factory({ type: 'keyValue' })\n\n// default public factory\nexport default factory()\n"],"names":["scope","action","toUpperCase","SET","prefix","RESET","ADD","UPDATE","REMOVE","ADD_OR_UPDATE","type","payload","key","getState","state","subState","undefined","path","_at","getFactory","getKeys","getAsArray","isInitialized","getData","length","data","keys","Array","isArray","map","k","propertyPath","values","filter","includes","d","initState","array","initialized","keyAlreadyExists","instanceKey","find","o","add","_uniq","update","reducer","_keyBy","element","_omit","_without","ctx","defaultData","init","prevCtx","middlewares","pre","engine","post","middleware","forEach","getWrappedStore","options","name","typeConfig","types","Object","assign","trampssType","actions","toLowerCase","selectors","error","Error","isMiddleware","params","isOptions","factory","forcedOptions","simpleObject","keyValue"],"mappings":"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"}