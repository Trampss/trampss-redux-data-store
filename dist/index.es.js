import{keyBy as n,without as t,uniq as r,omit as e,orderBy as u,get as i,isObjectLike as a,isString as c,flatten as o,at as f}from"lodash";var s,d,y,p=function(n){return"@@krf/"+n.toUpperCase()},l=function(n){return function(t){return(n?">":"")+n+">"+t}},v=function(n){return function(t){return p("SET"+l(n)(t))}},g=function(n){return function(t){return function(r){return{type:v(n)(t),payload:r}}}},O=function(n){return function(t){return p("RESET"+l(n)(t))}},E=function(n){return function(t){return function(){return{type:O(n)(t)}}}},b=function(n){return function(t){return p("ADD"+l(n)(t))}},j=function(n){return function(t){return p("UPDATE"+l(n)(t))}},m=function(n){return function(t){return function(r){return{type:j(n)(t),payload:r}}}},D=function(n){return function(t){return p("REMOVE"+l(n)(t))}},A=function(n){return function(t){return p("ADD_OR_UPDATE"+l(n)(t))}},k=function(n){return function(t){return p("REPLACE"+l(n)(t))}},R=function(n){return function(t){return p("ORDER_BY"+l(n)(t))}},T={set:g,SET:v,add:function(n){return function(t){return function(r){return{type:b(n)(t),payload:r}}}},ADD:b,reset:E,RESET:O,remove:function(n){return function(t){return function(r){return{type:D(n)(t),payload:r}}}},REMOVE:D,update:m,UPDATE:j,addOrUpdate:function(n){return function(t){return function(r){return{type:A(n)(t),payload:r}}}},ADD_OR_UPDATE:A,replace:function(n){return function(t){return function(r){return{type:k(n)(t),payload:r}}}},REPLACE:k,orderBy:function(n){return function(t){return function(r){return{type:R(n)(t),payload:r}}}},ORDER_BY:R},h={data:{},keys:[],array:[],initialized:!1},U=function(n){return function(t,r){return n.array.find(function(n){return n[t]===r})}},w=function(t,e){return{data:n(e,t),keys:r(e.map(function(n){return n[t]})),array:e,initialized:!0}},P=function(n,t,e){var u,i=e[n];return u=U(t)(n,i)?t.array.map(function(t){return t[n]===i?e:t}):t.array.concat([e]),Object.assign({},t,{data:Object.assign({},t.data,(s={},s[i]=e,s)),keys:r(t.keys.concat([i])),array:u,initialized:!0})},S=function(n,t,r){var e=r[n];return Object.assign({},t,{data:Object.assign({},t.data,(d={},d[e]=Object.assign({},t.data[e],r),d)),array:t.array.map(function(t){return t[n]===e?Object.assign({},t,r):t})})},z=function(n,t){return void 0!==t?w(n,t):h},_=function(n){return function(f){return function(s){return function(d){return function(p,l){void 0===p&&(p=z(n,d)),void 0===l&&(l={});var g=l.payload;switch(l.type){case v(f)(s):return w(n,g);case b(f)(s):return P(n,p,g);case A(f)(s):return U(p)(n,g[n])?S(n,p,g):P(n,p,g);case j(f)(s):return U(p)(n,g[n])?S(n,p,g):p;case k(f)(s):return U(p)(n,g[n])?function(n,t,r){var e=r[n];return Object.assign({},t,{data:Object.assign({},t.data,(y={},y[e]=r,y)),array:t.array.map(function(t){return t[n]===e?r:t})})}(n,p,g):p;case R(f)(s):var E=g,m="asc";a(g)&&(E=g.by,m=g.desc?"desc":"asc");var T=u(p.array,c(E)?function(n){return i(n,E)}:E,m);return Object.assign({},p,{array:T,keys:r(T.map(function(t){return t[n]}))});case D(f)(s):var h=o([g]);return Object.assign({},p,{data:e(p.data,h),keys:t.apply(void 0,[p.keys].concat(h)),array:p.array?p.array.filter(function(t){return!h.includes(t[n])}):[]});case O(f)(s):return z(n,d);default:return p}}}}}};var V=function(n){return function(t){var r=t,e=n.name,u=n.path;void 0!==u&&u.length>0&&(r=f(t,u)[0]);return r[e]}},B=function(n){return function(t){return function(r){return V(t)(r)[n]}}},x=B("keys"),C=B("array"),K=B("initialized"),L={},N=function(n){return void 0!==n?n:L},I=function(){return function(n){return function(t){return function(r){return function(e,u){void 0===e&&(e=N(r)),void 0===u&&(u={});var i=u.payload;switch(u.type){case v(n)(t):return i;case j(n)(t):return Object.assign({},e,i);case O(n)(t):return N(r);default:return e}}}}}};var M,Y,W=function(n){return function(){return function(t){return V(n)(t)}}},q={keyValue:{middlewares:[function(n){return function(t){return function(r){return function(e){return function(u){return void 0===u&&(u={}),Object.assign({},u,{state:_(n)(t)(r)(e)(u.state,u.action)})}}}}}],actions:T,selectors:{getState:V,getKeys:x,getAsArray:C,getLength:function(n){return function(t){return x(n)(t).length}},isInitialized:K,get:function(n){return function(t){return function(r){var e=function(n){return B("data")(n)}(n)(r);return null==t?e:Array.isArray(t)?t.map(function(n){return e[n]}):e[t]}}},getBy:function(n){return function(t,r){return function(e){var u=C(n)(e);return Array.isArray(r)?u.filter(function(n){return r.includes(f(n,t)[0])}):u.filter(function(n){return r===f(n,t)[0]})}}},hasKey:function(n){return function(t){return function(r){return x(n)(r).includes(t)}}}}},simpleObject:{middlewares:[function(n){return function(t){return function(r){return function(e){return function(u){return void 0===u&&(u={}),Object.assign({},u,{state:I(n)(t)(r)(e)(u.state,u.action)})}}}}}],actions:{set:g,SET:v,reset:E,RESET:O,update:m,UPDATE:j},selectors:{get:W,isInitialized:function(n){return function(t){return void 0!==n.defaultData?V(n)(t)!==n.defaultData:W(n)()(t)!==L}}}}};var F=function(n){return void 0===n&&(n={}),function(t){var r=t.key,e=t.type;void 0===e&&(e="keyValue");var u=t.prefix;void 0===u&&(u="");var i=t.name,a=t.defaultData,c=q[e];return Object.assign.apply(Object,[function(n){return function(t){return function(r){return function(e){return function(u){return function(i,a){void 0===a&&(a={});var c=a.type;void 0===c&&(c="UNKNOWN");var o={state:i,action:{type:c,payload:a.payload}};return(n.pre||[].concat(n.engine||[],n.post||[])).map(function(n){return n(t)(r)(e)(u)}).forEach(function(n){o=n(o)}),o.state}}}}}}(Object.assign({},n,{engine:c.middlewares}))(r)(u)(i)(a),{krfType:e}].concat(Object.keys(c.actions).map(function(n){return(M={})[n]=c.actions[n](u)(i),M}),Object.keys(c.selectors).map(function(n){return(Y={})[n]=c.selectors[n](t),Y})))}},G=function(){throw Error("parameter is not a middleware configuration, nor a factory option object.")},H=function(n){return void 0===n&&(n={}),function(t){return null==t&&G(),function(n){return n.engine||n.pre||n.post}(t)?function(r){return F(t)(Object.assign({},r,n))}:function(n){return!!n.name||"string"==typeof n}(t)?"string"==typeof t?F()(Object.assign({},{name:t},n)):F()(Object.assign({},t,n)):void G()}},J=H({type:"simpleObject"}),Q=H({type:"keyValue"});export default H();export{J as simpleObject,Q as keyValue};
