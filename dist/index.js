var n,t,r=require("lodash"),e=function(n){return"@@krf/"+n.toUpperCase()},u=function(n){return function(t){return(n?">":"")+n+">"+t}},i=function(n){return function(t){return e("SET"+u(n)(t))}},o=function(n){return function(t){return function(r){return{type:i(n)(t),payload:r}}}},c=function(n){return function(t){return e("RESET"+u(n)(t))}},a=function(n){return function(t){return function(){return{type:c(n)(t)}}}},f=function(n){return function(t){return e("ADD"+u(n)(t))}},s=function(n){return function(t){return e("UPDATE"+u(n)(t))}},d=function(n){return function(t){return function(r){return{type:s(n)(t),payload:r}}}},y=function(n){return function(t){return e("REMOVE"+u(n)(t))}},p=function(n){return function(t){return e("ADD_OR_UPDATE"+u(n)(t))}},l=function(n){return function(t){return e("REPLACE"+u(n)(t))}},v=function(n){return function(t){return e("ORDER_BY"+u(n)(t))}},g={set:o,SET:i,add:function(n){return function(t){return function(r){return{type:f(n)(t),payload:r}}}},ADD:f,reset:a,RESET:c,remove:function(n){return function(t){return function(r){return{type:y(n)(t),payload:r}}}},REMOVE:y,update:d,UPDATE:s,addOrUpdate:function(n){return function(t){return function(r){return{type:p(n)(t),payload:r}}}},ADD_OR_UPDATE:p,replace:function(n){return function(t){return function(r){return{type:l(n)(t),payload:r}}}},REPLACE:l,orderBy:function(n){return function(t){return function(r){return{type:v(n)(t),payload:r}}}},ORDER_BY:v},O={data:{},keys:[],array:[],initialized:!1},E=function(n,t){var r={};return function(n){return Array.isArray(n)?n:[n]}(t).forEach(function(t){r[t[n]]=t}),r},b=function(n){return function(t){return void 0!==n.data[t]}},j=function(n){return function(t){return Object.assign({},n,{data:t,keys:Object.keys(t),array:Object.values(t),initialized:!0})}},m=function(n,t,r){return j(t)(E(n,r))},A=function(t,r,e){var u=e[t];return j(r)(Object.assign({},r.data,((n={})[u]=e,n)))},D=function(n,r,e){var u=e[n];return j(r)(Object.assign({},r.data,((t={})[u]=Object.assign({},r.data[u],e),t)))},k=function(n,t){return void 0!==t?m(n,{},t):O},R=function(n){return function(t){return function(e){return function(u){return function(o,a){void 0===o&&(o=k(n,u)),void 0===a&&(a={});var d=a.payload;switch(a.type){case i(t)(e):return m(n,o,d);case f(t)(e):return A(n,o,d);case p(t)(e):return D(n,o,d);case y(t)(e):return function(n,t,e){return j(t)(r.omit(t.data,[].concat(e)))}(0,o,d);case c(t)(e):return k(n,u);case s(t)(e):return b(o)(d[n])?D(n,o,d):o;case l(t)(e):return b(o)(d[n])?A(n,o,d):o;case v(t)(e):var g=d,O="asc";"object"==typeof d&&d.by&&(g=d.by,O=d.desc?"desc":"asc");var E=r.orderBy(o.array,"string"==typeof g?function(n){return r.get(n,g)}:g,O);return Object.assign({},o,{array:E,keys:E.map(function(t){return t[n]})});default:return o}}}}}};var T=function(n){return function(t){var e=t,u=n.name,i=n.path;void 0!==i&&i.length>0&&(e=r.at(t,i)[0]);return e[u]}},h=function(n){return function(t){return function(r){return T(t)(r)[n]}}},U=h("keys"),w=h("array"),P=h("initialized"),S={},_=function(n){return void 0!==n?n:S},z=function(){return function(n){return function(t){return function(r){return function(e,u){void 0===e&&(e=_(r)),void 0===u&&(u={});var o=u.payload;switch(u.type){case i(n)(t):return o;case s(n)(t):return Object.assign({},e,o);case c(n)(t):return _(r);default:return e}}}}}};var B,V,C=function(n){return function(){return function(t){return T(n)(t)}}},K={keyValue:{middlewares:[function(n){return function(t){return function(r){return function(e){return function(u){return void 0===u&&(u={}),Object.assign({},u,{state:R(n)(t)(r)(e)(u.state,u.action)})}}}}}],actions:g,selectors:{getState:T,getKeys:U,getAsArray:w,getLength:function(n){return function(t){return U(n)(t).length}},isInitialized:P,get:function(n){return function(t){return function(r){var e=function(n){return h("data")(n)}(n)(r);return null==t?e:Array.isArray(t)?t.map(function(n){return e[n]}):e[t]}}},getBy:function(n){return function(t,e){return function(u){var i=w(n)(u);return Array.isArray(e)?i.filter(function(n){return e.includes(r.at(n,t)[0])}):i.filter(function(n){return e===r.at(n,t)[0]})}}},hasKey:function(n){return function(t){return function(r){return U(n)(r).includes(t)}}}}},simpleObject:{middlewares:[function(n){return function(t){return function(r){return function(e){return function(u){return void 0===u&&(u={}),Object.assign({},u,{state:z(n)(t)(r)(e)(u.state,u.action)})}}}}}],actions:{set:o,SET:i,reset:a,RESET:c,update:d,UPDATE:s},selectors:{get:C,isInitialized:function(n){return function(t){return void 0!==n.defaultData?T(n)(t)!==n.defaultData:C(n)()(t)!==S}}}}};var L=function(n){return void 0===n&&(n={}),function(t){var r=t.key,e=t.type;void 0===e&&(e="keyValue");var u=t.prefix;void 0===u&&(u="");var i=t.name,o=t.defaultData,c=K[e];return Object.assign.apply(Object,[function(n){return function(t){return function(r){return function(e){return function(u){return function(i,o){void 0===o&&(o={});var c=o.type;void 0===c&&(c="UNKNOWN");var a={state:i,action:{type:c,payload:o.payload}};return(n.pre||[].concat(n.engine||[],n.post||[])).map(function(n){return n(t)(r)(e)(u)}).forEach(function(n){a=n(a)}),a.state}}}}}}(Object.assign({},n,{engine:c.middlewares}))(r)(u)(i)(o),{krfType:e}].concat(Object.keys(c.actions).map(function(n){return(B={})[n]=c.actions[n](u)(i),B}),Object.keys(c.selectors).map(function(n){return(V={})[n]=c.selectors[n](t),V})))}},N=function(){throw Error("parameter is not a middleware configuration, nor a factory option object.")},x=function(n){return void 0===n&&(n={}),function(t){return null==t&&N(),function(n){return n.engine||n.pre||n.post}(t)?function(r){return L(t)(Object.assign({},r,n))}:function(n){return!!n.name||"string"==typeof n}(t)?"string"==typeof t?L()(Object.assign({},{name:t},n)):L()(Object.assign({},t,n)):void N()}},I=(x({type:"simpleObject"}),x({type:"keyValue"}),x());module.exports=I;
