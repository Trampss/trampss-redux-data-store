var n,t,r,e=require("lodash"),u=function(n){return"@@krf/"+n.toUpperCase()},i=function(n){return function(t){return(n?">":"")+n+">"+t}},a=function(n){return function(t){return u("SET"+i(n)(t))}},c=function(n){return function(t){return function(r){return{type:a(n)(t),payload:r}}}},o=function(n){return function(t){return u("RESET"+i(n)(t))}},f=function(n){return function(t){return function(){return{type:o(n)(t)}}}},s=function(n){return function(t){return u("ADD"+i(n)(t))}},d=function(n){return function(t){return u("UPDATE"+i(n)(t))}},y=function(n){return function(t){return function(r){return{type:d(n)(t),payload:r}}}},p=function(n){return function(t){return u("REMOVE"+i(n)(t))}},l=function(n){return function(t){return u("ADD_OR_UPDATE"+i(n)(t))}},v=function(n){return function(t){return u("REPLACE"+i(n)(t))}},g=function(n){return function(t){return u("ORDER_BY"+i(n)(t))}},O={set:c,SET:a,add:function(n){return function(t){return function(r){return{type:s(n)(t),payload:r}}}},ADD:s,reset:f,RESET:o,remove:function(n){return function(t){return function(r){return{type:p(n)(t),payload:r}}}},REMOVE:p,update:y,UPDATE:d,addOrUpdate:function(n){return function(t){return function(r){return{type:l(n)(t),payload:r}}}},ADD_OR_UPDATE:l,replace:function(n){return function(t){return function(r){return{type:v(n)(t),payload:r}}}},REPLACE:v,orderBy:function(n){return function(t){return function(r){return{type:g(n)(t),payload:r}}}},ORDER_BY:g},b={data:{},keys:[],array:[],initialized:!1},E=function(n){return function(t,r){return n.array.find(function(n){return n[t]===r})}},j=function(n,t){return{data:e.keyBy(t,n),keys:e.uniq(t.map(function(t){return t[n]})),array:t,initialized:!0}},m=function(t,r,u){var i,a=u[t];return i=E(r)(t,a)?r.array.map(function(n){return n[t]===a?u:n}):r.array.concat([u]),Object.assign({},r,{data:Object.assign({},r.data,(n={},n[a]=u,n)),keys:e.uniq(r.keys.concat([a])),array:i,initialized:!0})},k=function(n,r,e){var u=e[n];return Object.assign({},r,{data:Object.assign({},r.data,(t={},t[u]=Object.assign({},r.data[u],e),t)),array:r.array.map(function(t){return t[n]===u?Object.assign({},t,e):t})})},D=function(n,t){return void 0!==t?j(n,t):b},A=function(n){return function(t){return function(u){return function(i){return function(c,f){void 0===c&&(c=D(n,i)),void 0===f&&(f={});var y=f.payload;switch(f.type){case a(t)(u):return j(n,y);case s(t)(u):return m(n,c,y);case l(t)(u):return E(c)(n,y[n])?k(n,c,y):m(n,c,y);case d(t)(u):return E(c)(n,y[n])?k(n,c,y):c;case v(t)(u):return E(c)(n,y[n])?function(n,t,e){var u=e[n];return Object.assign({},t,{data:Object.assign({},t.data,(r={},r[u]=e,r)),array:t.array.map(function(t){return t[n]===u?e:t})})}(n,c,y):c;case g(t)(u):var O=y,b="asc";e.isObjectLike(y)&&(O=y.by,b=y.desc?"desc":"asc");var A=e.orderBy(c.array,e.isString(O)?function(n){return e.get(n,O)}:O,b);return Object.assign({},c,{array:A,keys:e.uniq(A.map(function(t){return t[n]}))});case p(t)(u):var R=e.flatten([y]);return Object.assign({},c,{data:e.omit(c.data,R),keys:e.without.apply(void 0,[c.keys].concat(R)),array:c.array?c.array.filter(function(t){return!R.includes(t[n])}):[]});case o(t)(u):return D(n,i);default:return c}}}}}};var R=function(n){return function(t){var r=t,u=n.name,i=n.path;void 0!==i&&i.length>0&&(r=e.at(t,i)[0]);return r[u]}},T=function(n){return function(t){return function(r){return R(t)(r)[n]}}},h=T("keys"),w=T("array"),S=T("initialized"),U={},P=function(n){return void 0!==n?n:U},z=function(){return function(n){return function(t){return function(r){return function(e,u){void 0===e&&(e=P(r)),void 0===u&&(u={});var i=u.payload;switch(u.type){case a(n)(t):return i;case d(n)(t):return Object.assign({},e,i);case o(n)(t):return P(r);default:return e}}}}}};var B,_,V=function(n){return function(){return function(t){return R(n)(t)}}},q={keyValue:{middlewares:[function(n){return function(t){return function(r){return function(e){return function(u){return void 0===u&&(u={}),Object.assign({},u,{state:A(n)(t)(r)(e)(u.state,u.action)})}}}}}],actions:O,selectors:{getState:R,getKeys:h,getAsArray:w,getLength:function(n){return function(t){return h(n)(t).length}},isInitialized:S,get:function(n){return function(t){return function(r){var e=function(n){return T("data")(n)}(n)(r);return null==t?e:Array.isArray(t)?t.map(function(n){return e[n]}):e[t]}}},getBy:function(n){return function(t,r){return function(u){var i=w(n)(u);return Array.isArray(r)?i.filter(function(n){return r.includes(e.at(n,t)[0])}):i.filter(function(n){return r===e.at(n,t)[0]})}}},hasKey:function(n){return function(t){return function(r){return h(n)(r).includes(t)}}}}},simpleObject:{middlewares:[function(n){return function(t){return function(r){return function(e){return function(u){return void 0===u&&(u={}),Object.assign({},u,{state:z(n)(t)(r)(e)(u.state,u.action)})}}}}}],actions:{set:c,SET:a,reset:f,RESET:o,update:y,UPDATE:d},selectors:{get:V,isInitialized:function(n){return function(t){return void 0!==n.defaultData?R(n)(t)!==n.defaultData:V(n)()(t)!==U}}}}};var L=function(n){return void 0===n&&(n={}),function(t){var r=t.key,e=t.type;void 0===e&&(e="keyValue");var u=t.prefix;void 0===u&&(u="");var i=t.name,a=t.defaultData,c=q[e];return Object.assign.apply(Object,[function(n){return function(t){return function(r){return function(e){return function(u){return function(i,a){void 0===a&&(a={});var c=a.type;void 0===c&&(c="UNKNOWN");var o={state:i,action:{type:c,payload:a.payload}};return(n.pre||[].concat(n.engine||[],n.post||[])).map(function(n){return n(t)(r)(e)(u)}).forEach(function(n){o=n(o)}),o.state}}}}}}(Object.assign({},n,{engine:c.middlewares}))(r)(u)(i)(a),{krfType:e}].concat(Object.keys(c.actions).map(function(n){return(B={})[n]=c.actions[n](u)(i),B}),Object.keys(c.selectors).map(function(n){return(_={})[n]=c.selectors[n](t),_})))}},C=function(){throw Error("parameter is not a middleware configuration, nor a factory option object.")},K=function(n){return void 0===n&&(n={}),function(t){return null==t&&C(),function(n){return n.engine||n.pre||n.post}(t)?function(r){return L(t)(Object.assign({},r,n))}:function(n){return!!n.name||"string"==typeof n}(t)?"string"==typeof t?L()(Object.assign({},{name:t},n)):L()(Object.assign({},t,n)):void C()}},N=(K({type:"simpleObject"}),K({type:"keyValue"}),K());module.exports=N;
